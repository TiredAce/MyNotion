## 第6章 分支语句和逻辑运算符

>[6.3 字符函数库](#6.3)
>
>[6.7 读取数字的循环](#6.7)
>
>[6.8 简单文件输入/输出](#6.8)

 <h3 id="6.3"> 6.3 字符函数库 cctype</h3>

​		`C++`有字符相关的、非常方便的函数软件包，它可以简化诸多确定字符是否为大写字母、数字、标点符号等工作，这些函数的原型是在头文件`cctype`中定义的。

​		`isalpha()`不仅更容易使用，而且更通用。用来检查字符是否为字母字符。使用`isdigits()`来测试字符是否为数字字符，使用`isspace()`来测试字符是否为空白，如换行符、空格和制表符等。使用`ispunct()`来测试字符是否为标点符号。

​		下表对`cctype`中的函数进行了总结。

<img src="./../assets/blog_res/第6章 分支语句和逻辑运算符.assets/1674890006639.png" alt="1674890006639" style="zoom: 50%;" />

 <h3 id="6.7"> 6.7 读取数字的循环</h3>

​		假设要编写一个将一系列数字读入到数组中的程序，并允许用户在数组填满之前结束输入。

​		如果用户输入的是一个单词，而不是一个数字，当发生类型不匹配的情况时，将发成以下情况：

> * `n`的值保持不变
> * 不匹配的输入将被保留在输入队列中
> * `cin`对象中的一个错误标记被设置
> * 对`cin`方法的调用将返回`false`。

​		可以通过如下循环来实现：

```c++
while (i < Max && cin >> fish[i]){}
```

​		程序中表达式`cin >> fish[i]`实际上一个是`cin`方法函数调用，该函数返回`cin`。如果`cin`位于测试条件中，则将被转换为`bool`类型。如果输入成功，则转换为`true`。如果表达式为`false`，则循环结束。

​		当用户输入的不是数字时，该程序将不再读取输入。下面来看一个继续读取的例子。假设程序要求用户提供得分，以计算平均成绩。如果用户输入非数字输入，程序将拒绝，并要求用户继续输入数字。可以看到，可以使用`cin`输入表达式的值来检测输入是不是数字。程序发现用户输入了错误内容时，应采取以下步骤：

> 1. 重置`cin`以接受新的输入。
> 2. 删除错误输入。
> 3. 提示用户再重新输入。

​		处理错误代码的关键部分如下：

```c++
while (!(cin >> golf[i]))
{
    cin.clear();
    while (cin.get() != '\n') continue;
    cout << "Please enter a number:" << endl;
}
```

​		该循环的第一条语句使用`clear()`方法重置输入，如果省略这条语句，程序将拒绝继续读取输入。接下来，程序再`while`循环中使用`cin.get()`来读取行尾之前的所有输入，从而删除这一行中的错误输入。另一种方法是读取到下一个空白字符，这样将每次删除一个单词，而不是一次删除整行。最后，程序告诉用户，应输入一个数字。

<h3 id="6.8"> 6.8 简单文件输入/输出 </h3>

#### 6.8.1 文本I/O和文本文件

​		使用`cin`进行输入是为一系列的字节，其中每个字节都被解释为字符编码。不管目标数据类型是什么，输入一开始都是字符数据——文本数据。然后，`cin`对象负责将文本转换为其他类型。为说明这是如何完成的，来看一些处理同一个输入行的代码。

​		例如有如下示例输入行：

```
38.4 19.2
```

​		使用`char`数据类型的情况：

```c++
char ch;
cin >> ch;
```

​		输入行中的第一个字符被赋值给`ch`。在这里，第一个字符是数字`3`，其字符编码被存储在变量`ch`中，输入和目标变量都是字符，因此不需要进行转换。这里存储的是字符`3`的编码。

​		使用`int`数据类型的情况：

```c++
int n;
cin >> n; 
```

​		这种情况下，`cin`将不断读取，直达遇到非数字字符。也就是说。它读取`3`和`8`，这样句点将成为输入队列中的下一个字符。`cin`通过计算发现，这两个字符对应数值`38`，因此将`38`的二进制编码复制到变量`n`中。

​		使用`double`类型的情况：

```c++
double x;
cin >> x;
```

​		在这种情况下，`cin`将不断读取，直到遇到非数字字符。也就是说，它将读取`3`和`8`，这样句点将成为输入队列中的下一个字符。`cin`通过计算发现对应的数值为`38.5`，因此将`38.5`的二进制编码复制到变量`x`中。

​		使用`char`数组的情况：

```c++
char word[50];
cin >> word;
```

​		这种情况下，`cin`将不断读取，直到遇到空白字符。也就是说，它读取到`38.5`使得空格成为输入队列中的下一个字符。然后，`cin`将这`4`个字符的字符编码存储到数组`word`中，并在末尾加上一个空字符。这里不需要进行任何转换。

​		最后，来看一下另一种使用`char`数组来存储输入的情况：

```c++
char word[50];
cin.getline(word, 50);
```

​		这种情况下，`cin`将不断读取，直到遇到换行符。所有字符都将被存储到数组`word`中，并在末尾加上一个空字符。换行符被丢弃，输入队列中的下一个字符是下一行中的第一个字符。

#### 6.8.2 写入到文本文件中

​		文件输出要包含一下条件：

> * 必须包含头文件`fstream`
> * 头文件`fstream`定义一个用于处理输出的`ofstream`类。
> * 需要声明一个或多个`ofstream`变量，并以自己喜欢的方式对其命名，条件是遵循常用的命名规则。
> * 必须指明名称空间`std`
> * 需要将`ofstream`对象与文件关联起来。方法之一是使用`open()`方法。
> * 使用完文件后，应使用方法`close()`将其关闭。
> * 可结合使用`ofstream`对象和运算符`<<`来输出各种类型的数据。

##### 1. 声明自己的ofstream对象

​		您必须要声明自己的`ofstream`对象，为其命名，并将其同文件关联起来：

```c++
ofstream outFile;   // outFile is an ofstream object
ofstream fout;      // fout is an ofstream object
```

##### 2. 将ofstream对象与文件相关联		

​		下面演示了如何将这种对象与特定的文件关联起来：

```c++
outFile.open("fish.txt");
char filename(50);
cin >> filename;
fout.open(filename);
```

​		注意，方法`open()`接受一个字符串作为参数，这可以是一个字面字符串，也可以是存储在数组中的字符串。下面代码展示使用这种对象：

```c++
double wt = 125.8;
outFile << wt;
char line[81] = "object are closer than they appear.";
fout << line << endl;
```

​		重要的是，声明一个`ofstream`对象并将其同文件关联起来后，便可以像使用`cout`那样使用它。所有可用于`cout`的操作和方法都可用于`ofstream`对象。

**总之，使用文件输入的主要步骤如下：**

1. 包含头文件`fstream`
2. 创建一个`ofstream`对象
3. 将该`ofstream`对象同一个文件关联起来
4. 就像使用`cout`那样使用该`ofstream`对象

**警告**：打开已有的文件，以接受输出时，默认将它其长度截断为零，因此原来的内容将丢失。

#### 6.8.3 读取文本文件

​		文本输入与控制台输入及其相似：

> * 必须包含头文件`fstream`
> * 头文件`fstream`定义一个用于处理输入的`ifstream`类。
> * 需要声明一个或多个`ifstream`变量，并以自己喜欢的方式对其进行命名，条件是遵守常用的命名规则。
> * 必须指明名称空间`std`
> * 需要将`ifstream`对象与文件关联起来。方法之一是使用`open()`方法。
> * 使用完文件后，应使用方法`close()`将其关闭。
> * 可结合使用`ifstream`对象和运算符`>>`来输出各种类型的数据。
> * 可以使用`ifstream`对象和`get()`方法来读取一个字符，使用`ifstream()`对象和`getline()`来读取一行字符。
> * 可以结合使用`ifstream`和`eof()`、`fail()`等方法来判断输入是否成功。
> * `ifstream`对象本身被用作测试条件时，如果最后一个读取操作成功，它将被转换为`true`，否则为`false`。

##### 1. 声明自己的ifstream对象

```c++
ifstream inFile;
ifstream fin;
```

##### 2. 关联文件

```c++
inFile.open("bowling.txt");
char filename[50];
cin >> filename;
fin.open(filename);
```

​		如果试图打开一个不存在的文件用于输入，这种错误将导致后面使用`ifstream`对象进行输入时失败。检查文件是否被成功打开的首先方法是使用`is_open`方法，可以使用如下代码：

```c++
inFile.open("bowling.txt");
if (!inFile.is_open())
{
	exit(EXIT_FAILURE);
}
```

​		如果文件被成功打开，方法 `is_open()`返回`true`。反之，返回`false`。函数`exit()`的原型是在头文件`cstdlib`中定义的，在该头文件中，还定义一个用于同操作系统通信的参数值`EXIT_FAILURE`。函数`exit()`终止程序。

​		如果最后一次读取操作中发生了类型不匹配的情况，方法`fail()`将返回`true`（`EOF`也将返回`false`）。最后，可能出现意外的问题，如文件损坏或硬件故障。如果最后一次读取文件时发生了这样的问题，方法`bad()`将返回`true`。一种更简单的方法`good()`的方法，该方法在没有发生任何错误时返回`true`。
