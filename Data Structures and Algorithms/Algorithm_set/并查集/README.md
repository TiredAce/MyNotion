# Part5 并查集

>[1. 并查集](#1)
>
>[2. 习题](#2)

<h2 id = "1">
1. 并查集
</h2>

并查集时一种可以动态维护若干个不重叠的集合，并支持合并与查询的数据结构。并查集的基本操作如下：

1. `Get`，查询一个数在哪个集合中。
2. `Merge`，合并两个集合。

在并查集中采用“代表法”，**即为每个集合选择一个固定的元素，作为整个几个的代表**。

使用并查集时最重要的思想就是路径压缩与按秩合并。路径压缩，就是在执行`Get`操作时，把每个访问过的节点都指向根节点；按秩合并也叫做”启发式合并“，其实就是小的结构合并到大的结构上，并且只增加小的结构的查询代价。

#### 1.1 并查集的基本实现

1. 并查集的初始化

```c++
int p[N];   // 用p数组记录每个节点的父节点
for (int i = 1; i <= n; i ++) p[i] = i;   // 初始化父节点指向自己
```

2. 并查集的`Get`操作，(个人习惯叫做`find`操作)

```c++
int find(int x)
{
	if (x != p[x]) p[x] = find(p[x]);
	return p[x];
}
```

3. 并查集的`Merge`操作

```c++
void merge(int x, int y)
{
	if (get(x) != get(y))
	{
		p[get(x)] = get(y);
	}
}
```

当然，并查集还有许多拓展的模型，用来记录节点的距离的并查集等等，在习题中再介绍。

<h2 id = "2">
2. 习题
</h2>

>[1. 食物链](#2.1)
>
>[2. 银河英雄传说](#2.2)

<h3 id = "2.1">
2.1. 食物链
</h3>

**题目描述**：动物王国中有三类动物 $A,B,C$,这三类动物的食物链构成了有趣的环形。

$A$ 吃 $B$，$B$ 吃 $C$，$C$ 吃 $A$。

现有 $N$ 个动物，以 $1∼N$ 编号。

每个动物都是 $A,B,C$ 中的一种，但是我们并不知道它到底是哪一种。

有人用两种说法对这 $N$ 个动物所构成的食物链关系进行描述：

第一种说法是 `1 X Y`，表示 $X$ 和 $Y$ 是同类。

第二种说法是 `2 X Y`，表示 $X$ 吃 $Y$。

此人对 $N$ 个动物，用上述两种说法，一句接一句地说出 $K$ 句话，这 $K$ 句话有的是真的，有的是假的。

当一句话满足下列三条之一时，这句话就是假话，否则就是真话。

1. 当前的话与前面的某些真的话冲突，就是假话；
2. 当前的话中 $X$ 或 $Y$ 比 $N$ 大，就是假话；
3. 当前的话表示 $X$ 吃 $X$，就是假话。

你的任务是根据给定的 $N$ 和 $K$ 句话，输出假话的总数。

**数据范围**：$1 \le N \le 50000, \ 0\le K \le 100000$

**思路**：之前提及过可以用并查集来维护结点之间的距离，这道题就可以使用这种思想来解决。关系可以分为三种，如果`a`能吃`b`，可以抽象成$d_a - d_b \equiv 1 (mod \ 3)$；如果`a`和`b`是同种生物，那么满足$d_a - d_b \equiv 0 (mod \ 3)$；如果`a`会被`b`吃，可以抽象成**$d_a - d_b \equiv 2 (mod \ 3)$**。其中$d_x$表示的是$x$节点到根节点的距离。这里主要思想就是有三种动物，那么它们的关系可以抽象为两者距离差的关系，因为关系存在三种，那么可以通过$mod \ 3$映射成三种结果。

[Code:2_1.cpp](./2_1.cpp)

<h3 id = "2.2">
2.2 银河英雄传说
</h3>

**题目描述**：有一个划分为 $N$ 列的星际战场，各列依次编号为 $1,2,…,N$。

有 $N$ 艘战舰，也依次编号为 $1,2,…,N$，其中第 $i$ 号战舰处于第 $i$ 列。

有 $T$ 条指令，每条指令格式为以下两种之一：

1. `M i j`，表示让第 $i$ 号战舰所在列的全部战舰保持原有顺序，接在第 $j$ 号战舰所在列的尾部。
2. `C i j`，表示询问第 $i$ 号战舰与第 $j$ 号战舰当前是否处于同一列中，如果在同一列中，它们之间间隔了多少艘战舰。

现在需要你编写一个程序，处理一系列的指令。

**数据范围**：$N \le 30000, \ T \le 500000$

**思路**：该题与上一题的食物链思想类似，本质就是维护结点到根节点的距离，假设相邻的战舰距离为`1`，那么两艘战舰中间相隔的战舰数量很好求得。

[Code:2_2.cpp](./2_2.cpp)